name: Version Bump

on:
  pull_request:
    types: [closed]
    branches: [master]

jobs:
  bump-uv:
    runs-on: ubuntu-latest
    needs: bump-version
    steps:

      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"

      - name: Determine new version
        id: semver
        run: |
          labels=$(jq -r '.pull_request.labels[].name' "$GITHUB_EVENT_PATH" 2>/dev/null || true)
          semver=""
          for want in major minor patch; do
            if echo "$labels" | tr '[:upper:]' '[:lower:]' | grep -q "$want"; then
              semver=$want
              break
            fi
          done
          if [ -z "$semver" ]; then
            semver=patch
          fi
          echo "type=$semver" >> "$GITHUB_OUTPUT"
        shell: bash

      - name: Bump uv version
        run: uv version --bump ${{ steps.semver.outputs.type }}
